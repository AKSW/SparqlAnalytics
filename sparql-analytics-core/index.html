<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html class="js" lang="en" dir="ltr" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
    
<head>    
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
	<title>SPARQL Analytics Demo</title>
      

	<link rel="stylesheet" href="lib/twitter-bootstrap/2.0.3/css/bootstrap.min.css" /> 
  	<link rel="stylesheet" href="lib/Font-Awesome/current/css/font-awesome.css" />
    
    <script type="text/javascript" src="lib/jquery/1.9.1/jquery-1.9.1.js"></script>
	<script type="text/javascript" src="lib/underscore/1.3.1/underscore.js"></script>


	<script src="lib/highcharts/2.2.5/js/highcharts.js"></script>
	<script src="lib/highcharts/2.2.5/js/modules/exporting.js"></script>

	
	<script type="text/javascript" src="lib/canvg/current/rgbcolor.js"></script>
	<script type="text/javascript" src="lib/canvg/current/canvg.js"></script> 

    <script type="text/javascript" src="lib/namespacedotjs/a28da387ce/Namespace.js"></script>

	<script type="text/javascript" src="src/main/webapp/js/org/aksw/utils/MathUtils.js"></script>
	<script type="text/javascript" src="src/main/webapp/js/org/aksw/utils/ChartUtils.js"></script>
	<script type="text/javascript" src="src/main/webapp/js/org/aksw/sparql-analytics/app/Charts.js"></script>
		
	
	<script type="text/javascript">
		var charts = Namespace("org.aksw.sparql-analytics.charts");


		
		var activeChart = null;
	
		var scheduleUpdateChart = function() {
			
			setTimeout(function() {
				updateChart();
				scheduleUpdateChart();
			}, 5000);

		};

		var updateChart = function() {
			
			var request = $.ajax({
				url: 'api/min', // Assumes <host-name>/sparql-analytics/api/min
				//cache: false,
				//url: "http://localhost/api/min",
				type: 'get',
				dataType: 'json'
			});
			
			request.done(function(json) {
				if(activeChart) {
					//activeChart.destroy();
					activeChart.xAxis[0].setCategories(json.labels, false);
					activeChart.series[0].setData(json.data);
					activeChart.redraw();
					
					//var series = activeChart.series[0];
					//series.setState(json);

					//console.log("Series", series);
					//series.setData(json.data);
					//series.setLables(json.labels);
					
				} else {
				
					json.name = "Recent Query Load";
	
					var chartDiv = $('#histogram');
					var elChartDiv = chartDiv.get(0);
					
					var chartSpec = charts.createHistogramChartSpec(json);

					/*
					_.extend(chartSpec, {
						plotOptions: {
							area: { animation: false },
							line: { animation: false }
						}
					});*/
					
					chartSpec.chart.renderTo = elChartDiv;
					activeChart = new Highcharts.Chart(chartSpec);
				}
				
			}).fail(function(msg) {
				var chartDiv = $('#histogram');
				chartDiv.html("Something went wrong loading chart data");
			});
		}
		

	    $(document).ready(function() {

	    	scheduleUpdateChart();
	        
	    });

	</script>
    </head>

<body>

<div id="histogram" style="width: 500px; height: 300px;"></div>

</body>

</html>
